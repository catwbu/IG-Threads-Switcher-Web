<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IG/Threads 網址轉換器</title>
    <link rel="icon" href="icon2.png" type="image/png">
    <link rel="apple-touch-icon" href="icon2.png">
    <style>
        body {
            background-color: #121212; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box;
        }
        .container {
            background-color: #1e1e1e; padding: 25px; border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 100%; max-width: 400px; text-align: center;
        }
        h1 { color: #f0f0f0; margin-top: 0; margin-bottom: 20px; font-size: 24px; }
        #urlInput {
            width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 6px;
            border: 1px solid #444; background-color: #2c2c2c; color: #fff;
            font-size: 16px; box-sizing: border-box;
        }
        #urlInput::placeholder { color: #888; }
        #pasteButton { /* 新增貼上按鈕的樣式 */
            width: 100%; padding: 10px; margin-bottom: 20px; background-color: #3a3a3a;
            color: #e0e0e0; font-size: 16px; border: 1px solid #555; border-radius: 6px;
            cursor: pointer;
        }
        #goButton {
            width: 100%; padding: 15px; background-color: #f2f1ef; color: #121212;
            font-size: 18px; font-weight: bold; border: none; border-radius: 6px;
            cursor: pointer; transition: background-color 0.2s ease;
        }
        #goButton:hover { background-color: #e0e0e0; }
        #goButton:active { background-color: #cccccc; }
        #statusText { margin-top: 15px; color: #82c91e; /* 綠色用於成功提示 */ min-height: 20px; font-size: 14px; }
        .error-text { color: #ff5252 !important; /* 紅色用於錯誤 */ }
        .clipboard-info { font-size: 12px; color: #aaa; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>IG/Threads 轉換器</h1>
        <p class="clipboard-info">複製 IG/Threads 個人網址後，點擊下方貼上</p>
        <input type="text" id="urlInput" placeholder="IG/Threads 個人網址">
        <button id="pasteButton">從剪貼簿貼上網址</button>
        <button id="goButton" style="display: none;">開啟轉換後的頁面</button>
        <p id="statusText"></p>
    </div>

    <script>
        const urlInput = document.getElementById('urlInput');
        const pasteButton = document.getElementById('pasteButton');
        const goButton = document.getElementById('goButton');
        const statusText = document.getElementById('statusText');
        let convertedHttpsUrl = null; // 儲存轉換後的 HTTPS URL

        function getUsernameAndType(url) {
            let username = null;
            if (!url || typeof url !== 'string') return null;
            let igMatch = url.match(/instagram\.com\/([a-zA-Z0-9._]+)(?:\/(?!p\/|reel\/|reels\/|$))?/);
            if (igMatch && igMatch[1]) {
                if (!['p', 'reel', 'reels', 'stories', 'explore', 'accounts', 'direct'].includes(igMatch[1])) {
                    return { type: 'instagram', username: igMatch[1] };
                }
            }
            let threadsMatch = url.match(/threads\.(?:net|com)\/@([a-zA-Z0-9._]+)(?:\/|$)/);
            if (threadsMatch && threadsMatch[1]) {
                return { type: 'threads', username: threadsMatch[1] };
            }
            return null;
        }

        function generateConvertedHttpsUrl(originalUrl) {
            const userInfo = getUsernameAndType(originalUrl.trim());
            if (userInfo && userInfo.username) {
                if (userInfo.type === 'instagram') {
                    return `https://www.threads.net/@${userInfo.username}`; // IG -> Threads
                } else if (userInfo.type === 'threads') {
                    return `https://www.instagram.com/${userInfo.username}/`; // Threads -> IG
                }
            }
            return null;
        }

        async function handlePaste() {
            statusText.textContent = ''; // 清除舊訊息
            statusText.classList.remove('error-text');
            goButton.style.display = 'none'; // 先隱藏開啟按鈕
            convertedHttpsUrl = null;

            if (!navigator.clipboard || typeof navigator.clipboard.readText !== 'function') {
                statusText.textContent = '您的瀏覽器不支援讀取剪貼簿。';
                statusText.classList.add('error-text');
                return;
            }

            try {
                const text = await navigator.clipboard.readText();
                if (text) {
                    urlInput.value = text; // 填入輸入框
                    convertedHttpsUrl = generateConvertedHttpsUrl(text); // 轉換網址

                    if (convertedHttpsUrl) {
                        const targetPlatform = convertedHttpsUrl.includes('threads.net') ? 'Threads' : 'Instagram';
                        goButton.textContent = `在 App 中開啟 ${targetPlatform} 個人頁面`;
                        goButton.style.display = 'block'; // 顯示開啟按鈕
                        statusText.textContent = '網址已轉換！請點擊上方按鈕開啟。';
                    } else {
                        statusText.textContent = '無法識別或不支援此網址格式。';
                        statusText.classList.add('error-text');
                    }
                } else {
                    statusText.textContent = '剪貼簿是空的。';
                    statusText.classList.add('error-text');
                }
            } catch (err) {
                console.error('讀取剪貼簿失敗:', err);
                if (err.name === 'NotAllowedError' || err.name === 'SecurityError') {
                     statusText.textContent = '讀取剪貼簿失敗。瀏覽器可能需要您先與頁面互動 (例如點擊頁面)，或此功能受安全性限制。';
                } else {
                     statusText.textContent = '讀取剪貼簿時發生錯誤。';
                }
                statusText.classList.add('error-text');
            }
        }

        pasteButton.addEventListener('click', handlePaste);

        goButton.addEventListener('click', () => {
            if (convertedHttpsUrl) {
                // 手動點擊時，使用 window.open。
                // Universal Links (HTTPS) 在使用者直接點擊時，最有機會成功喚起 App。
                statusText.textContent = `正在嘗試開啟 ${convertedHttpsUrl.includes('threads.net') ? 'Threads' : 'Instagram'} App...`;
                statusText.classList.remove('error-text');
                const openedWindow = window.open(convertedHttpsUrl, '_blank');
                if (!openedWindow || openedWindow.closed || (typeof openedWindow.closed !== 'undefined' && openedWindow.closed) ) {
                    // 如果彈出視窗被阻止，提示使用者
                    setTimeout(() => {
                         statusText.textContent = '如果 App 未開啟，請檢查瀏覽器的彈出視窗設定，或確認 App 已安裝。';
                         statusText.classList.add('error-text');
                    }, 1000);
                }
            } else {
                statusText.textContent = '沒有可開啟的有效網址。';
                statusText.classList.add('error-text');
            }
        });

        // 當使用者手動修改輸入框內容時，也嘗試轉換並更新按鈕
        urlInput.addEventListener('input', () => {
            const currentInput = urlInput.value;
            convertedHttpsUrl = generateConvertedHttpsUrl(currentInput);
            if (convertedHttpsUrl) {
                const targetPlatform = convertedHttpsUrl.includes('threads.net') ? 'Threads' : 'Instagram';
                goButton.textContent = `在 App 中開啟 ${targetPlatform} 個人頁面`;
                goButton.style.display = 'block';
                statusText.textContent = '網址已就緒，可點擊按鈕開啟。';
                statusText.classList.remove('error-text');
            } else {
                goButton.style.display = 'none';
                if (currentInput.trim() !== '') { // 只有當輸入框非空且無法轉換時才提示
                    statusText.textContent = '輸入的網址格式無法識別。';
                    statusText.classList.add('error-text');
                } else {
                    statusText.textContent = ''; // 清空提示
                }
            }
        });

    </script>
</body>
</html>
