<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IG/Threads 網址轉換器</title>

    <link rel="icon" href="icon2.png" type="image/png">
    <link rel="apple-touch-icon" href="icon2.png">
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: #1e1e1e;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px; /* 限制最大寬度，適合手機 */
            text-align: center;
        }

        h1 {
            color: #f0f0f0;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 24px;
        }

        #urlInput {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 6px;
            border: 1px solid #444;
            background-color: #2c2c2c;
            color: #fff;
            font-size: 16px;
            box-sizing: border-box;
        }

        #urlInput::placeholder {
            color: #888;
        }

        #goButton {
            width: 100%;
            padding: 15px;
            background-color: #f2f1ef;
            color: #121212;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        #goButton:hover {
            background-color: #e0e0e0;
        }
         #goButton:active {
            background-color: #cccccc;
        }

        #statusText {
            margin-top: 15px;
            color: #ff5252; /* 紅色用於錯誤/警告 */
            min-height: 20px; /* 避免內容跳動 */
            font-size: 14px;
        }

        .clipboard-info {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>IG/Threads 轉換器</h1>
        <p class="clipboard-info">將嘗試自動讀取剪貼簿中的網址</p>
        <input type="text" id="urlInput" placeholder="貼上或等待自動填入網址">
        <button id="goButton">轉換並開啟</button>
        <p id="statusText"></p>
    </div>

    <script>
        // 您的 JavaScript 內容不變
        const urlInput = document.getElementById('urlInput');
        const goButton = document.getElementById('goButton');
        const statusText = document.getElementById('statusText');

        // 核心轉換邏輯 (來自您的 popup.js)
        function getUsername(url) {
            let username = null;
            if (!url || typeof url !== 'string') return null;

            // Instagram: instagram.com/username or instagram.com/username/
            // 排除 /p/, /reel/, /reels/ 等路徑
            let igMatch = url.match(/instagram\.com\/([a-zA-Z0-9._]+)(?:\/(?!p\/|reel\/|reels\/|$))?/);
            if (igMatch && igMatch[1]) {
                 // 確保捕獲的不是 'p', 'reel', 'reels' 等關鍵字本身
                if (!['p', 'reel', 'reels', 'stories', 'explore', 'accounts', 'direct'].includes(igMatch[1])) {
                    username = igMatch[1];
                    return { type: 'instagram', username: username };
                }
            }
            
            // Threads: threads.net/@username or threads.net/@username/
            let threadsMatch = url.match(/threads\.(?:net|com)\/@([a-zA-Z0-9._]+)(?:\/|$)/);
            if (threadsMatch && threadsMatch[1]) {
                username = threadsMatch[1];
                return { type: 'threads', username: username };
            }
            return null;
        }

        function convertUrl(originalUrl) {
            if (!originalUrl) return null;
            const userInfo = getUsername(originalUrl.trim());
            let newUrl = null;

            if (userInfo && userInfo.username) {
                if (userInfo.type === 'instagram') {
                    newUrl = `https://www.threads.net/@${userInfo.username}`;
                } else if (userInfo.type === 'threads') {
                    newUrl = `https://www.instagram.com/${userInfo.username}/`;
                }
            }
            return newUrl;
        }

        // 處理按鈕點擊
        goButton.addEventListener('click', () => {
            const originalUrl = urlInput.value;
            if (!originalUrl) {
                statusText.textContent = '請輸入或貼上網址。';
                return;
            }

            const newUrl = convertUrl(originalUrl);

            if (newUrl) {
                statusText.textContent = `正在開啟: ${newUrl}`;
                window.open(newUrl, '_blank'); // 在新分頁開啟
            } else {
                statusText.textContent = '無法識別或不支援此網址格式。';
            }
        });

        // 嘗試從剪貼簿讀取網址
        async function tryReadFromClipboard() {
            if (!navigator.clipboard || typeof navigator.clipboard.readText !== 'function') {
                statusText.textContent = '您的瀏覽器不支援自動讀取剪貼簿。';
                return;
            }

            try {
                // 檢查剪貼簿讀取權限狀態 (如果支援的話)
                if (navigator.permissions && typeof navigator.permissions.query === 'function') {
                    const permissionStatus = await navigator.permissions.query({ name: 'clipboard-read' });
                    if (permissionStatus.state === 'denied') {
                        statusText.textContent = '讀取剪貼簿權限被拒。請手動貼上網址。';
                        return;
                    }
                    // 如果是 'prompt', 瀏覽器會在實際讀取時詢問用戶
                }
                
                const text = await navigator.clipboard.readText();
                if (text) {
                    // 簡單檢查是否可能是網址
                    if (text.startsWith('http://') || text.startsWith('https://') || text.includes('.com') || text.includes('.net')) {
                        urlInput.value = text;
                        statusText.textContent = '已從剪貼簿讀取網址。';
                        // 可選：自動觸發轉換
                        // goButton.click(); 
                    } else {
                        statusText.textContent = '剪貼簿內容非有效網址。';
                    }
                } else {
                    // statusText.textContent = '剪貼簿是空的。'; // 如果剪貼簿為空，可能不需要提示
                }
            } catch (err) {
                console.error('讀取剪貼簿失敗:', err);
                if (err.name === 'NotAllowedError' || err.name === 'SecurityError') {
                     statusText.textContent = '讀取剪貼簿失敗。瀏覽器可能需要您先與頁面互動，或此功能受安全性限制。';
                } else if (err.name === 'NotFoundError'){
                     // 通常意味著剪貼簿是空的或不包含文本
                     // statusText.textContent = '剪貼簿無文字內容可讀取。';
                } else {
                     statusText.textContent = '讀取剪貼簿時發生錯誤。';
                }
            }
        }

        // 當頁面載入完成或輸入框獲得焦點時，嘗試讀取剪貼簿
        window.addEventListener('load', tryReadFromClipboard);
        urlInput.addEventListener('focus', tryReadFromClipboard); // 當使用者點擊輸入框時再次嘗試

    </script>
</body>
</html>